# ボットリスナーシステム 使用ガイド

このシステムは、人間の配信者に対して複数のAIボットが視聴者として反応するシミュレーションを提供します。配信者がコンテンツを送信すると、接続されたボットリスナーがそれに対してAIで生成された反応を返します。

## システム構成

システムは3つの主要コンポーネントで構成されています：

1. **サーバー（`bot_system.py`）**: WebSocketを使用して配信者とボットリスナーを接続するFastAPIアプリケーション
2. **配信者クライアント**: 配信コンテンツを送信するためのCLIインターフェース
3. **ボットリスナークライアント**: 配信を「視聴」して反応を返すAIボット

## セットアップ

### 必要な依存関係

以下のPythonパッケージをインストールしてください：

```bash
pip install fastapi uvicorn websockets openai python-dotenv
```

### 環境変数の設定

`.env`ファイルを作成し、OpenAI APIキーを設定してください：

```
OPENAI_API_KEY=your_api_key_here
```

## 使用方法

### サーバーの起動

以下のコマンドでサーバーを起動します：

```bash
uvicorn bot_system:app --reload
```

これにより、デフォルトでは`http://localhost:8000`でサーバーが起動します。

### 配信者クライアントの使用

配信者として接続するには：

```bash
python test_clients.py broadcaster --uri ws://localhost:8000/
```

接続後、テキストを入力してEnterキーを押すと、そのコンテンツが「配信」され、接続中のすべてのボットリスナーに送信されます。

### ボットリスナークライアントの使用

単一のボットリスナーとして接続するには：

```bash
python test_clients.py bot-viewer --uri ws://localhost:8000/
```

複数のボットを同時にシミュレーションするには：

```bash
python test_clients.py multi-bot --uri ws://localhost:8000/ --bots 5
```

`--bots`パラメータで、シミュレーションするボットの数を指定できます。

## 機能詳細

### メタデータと設定

サーバーは、以下のようなメタデータをOpenAI APIに送信し、コンテキストを提供します：

- **配信情報**: タイトル、期間、視聴者数など
- **ボット個性**: 性格タイプ、興味、絵文字使用頻度など
- **コンテンツ分析**: トピック、ムードなど

これらの情報は、より自然で多様なボット反応の生成に役立ちます。

### JSONメッセージ形式

システムでは、以下のようなJSONメッセージ形式が使用されます：

**配信コンテンツ（配信者 → ボット）**:
```json
{
  "type": "stream_content",
  "content": "今日はプログラミングについて話します。",
  "timestamp": 1650000000,
  "stream_info": {
    "title": "プログラミング配信",
    "duration": 300,
    "viewers": 5
  }
}
```

**ボット反応（ボット → 配信者）**:
```json
{
  "type": "reaction",
  "content": "プログラミング大好きです！何について話しますか？👨‍💻",
  "bot_info": {
    "id": "bot123",
    "name": "TechBot",
    "personality_type": "enthusiastic"
  },
  "timestamp": 1650000005
}
```

## 拡張と応用

このシステムは以下のように拡張できます：

1. **ボット個性の多様化**: より多くの個性タイプや興味の追加
2. **マルチメディア対応**: テキスト以外の配信コンテンツ（画像、音声など）の処理
3. **ボット間の相互作用**: ボット同士が互いの反応に反応する機能
4. **長期的記憶**: 配信履歴を記憶して文脈を理解する機能
5. **WebUIの追加**: 配信内容とボット反応を視覚的に表示するインターフェース

## トラブルシューティング

- **接続エラー**: サーバーが起動していることと、URIが正しいことを確認してください
- **API制限**: OpenAIのAPIリクエスト制限に注意してください
- **ボット反応なし**: `OPENAI_API_KEY`が正しく設定されていることを確認してください

## APIエンドポイント

- `/broadcaster`: 配信者用WebSocketエンドポイント
- `/bot-viewer`: ボットリスナー用WebSocketエンドポイント
- `/health`: システムのヘルスチェック用HTTPエンドポイント
- `/`: APIドキュメントへのリンクを含むルートエンドポイント
- `/docs`: FastAPI自動生成ドキュメント（Swagger UI）